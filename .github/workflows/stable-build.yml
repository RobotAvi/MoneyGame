name: ğŸš€ Stable Build & Release

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  GRADLE_OPTS: -Dorg.gradle.daemon=false -Dorg.gradle.parallel=true -Dorg.gradle.configureondemand=true
  MAESTRO_CLI_ANALYSIS_NOTIFICATION_DISABLED: "true"

jobs:
  setup-android-sdk:
    runs-on: ubuntu-latest
    outputs:
      sdk-path: /home/runner/android-sdk
      version: ${{ steps.version.outputs.version }}
      version_code: ${{ steps.version.outputs.version_code }}
      date: ${{ steps.date.outputs.date }}
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      - name: ğŸ“… Get current date
        id: date
        run: echo "date=$(date '+%Y%m%d-%H%M')" >> $GITHUB_OUTPUT
      - name: ğŸ”– Get version info
        id: version
        run: |
          echo "ğŸ” ==== ĞŸĞĞ›Ğ£Ğ§Ğ•ĞĞ˜Ğ• Ğ’Ğ•Ğ Ğ¡Ğ˜Ğ˜ ===="
          echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ app/build.gradle..."
          ls -la app/build.gradle || echo "âŒ app/build.gradle Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ” Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ app/build.gradle:"
          cat app/build.gradle | grep -E "(versionName|versionCode)" || echo "âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ versionName Ğ¸Ğ»Ğ¸ versionCode"
          
          VERSION=$(grep -oP 'versionName\s+"\K[^"]+' app/build.gradle)
          VERSION_CODE=$(grep -oP 'versionCode\s+\K[0-9]+' app/build.gradle)
          
          echo "ğŸ” Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ: $VERSION"
          echo "ğŸ” Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ²ĞµÑ€ÑĞ¸Ğ¸: $VERSION_CODE"
          
          if [ -z "$VERSION" ]; then
            echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ versionName"
            exit 1
          fi
          if [ -z "$VERSION_CODE" ]; then
            echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ versionCode"
            exit 1
          fi
          
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "version_code=$VERSION_CODE" >> $GITHUB_OUTPUT
          echo "âœ… Ğ’ĞµÑ€ÑĞ¸Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ°: $VERSION ($VERSION_CODE)"
      - name: ğŸ—ï¸ Prepare Android SDK directories
        id: set-sdk-path
        run: |
          echo "sdk_path=/home/runner/android-sdk" >> $GITHUB_OUTPUT
          mkdir -p /home/runner/android-sdk
          echo "ANDROID_SDK_ROOT=/home/runner/android-sdk" >> $GITHUB_ENV
          echo "ANDROID_HOME=/home/runner/android-sdk" >> $GITHUB_ENV
      - name: ğŸ› ï¸ Download and install Android commandline tools
        run: |
          echo "ğŸ”§ ==== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ANDROID COMMANDLINE TOOLS ===="
          set -x
          
          echo "ğŸ”§ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²..."
          sudo apt-get update
          
          echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° wget Ğ¸ unzip..."
          sudo apt-get install -y wget unzip
          
          echo "ğŸ”§ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° commandline tools..."
          wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O cmdline-tools.zip
          echo "ğŸ”§ Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ÑĞºĞ°Ñ‡Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°:"
          ls -la cmdline-tools.zip
          
          echo "ğŸ”§ Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ° commandline tools..."
          unzip cmdline-tools.zip -d $HOME
          echo "ğŸ”§ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ $HOME Ğ¿Ğ¾ÑĞ»Ğµ Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ¸:"
          ls -la $HOME/ | grep cmdline
          
          echo "ğŸ”§ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹..."
          mkdir -p $HOME/android-sdk/cmdline-tools
          mv $HOME/cmdline-tools $HOME/android-sdk/cmdline-tools/latest
          
          echo "ğŸ”§ ==== Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ CMDLINE-TOOLS ===="
          find $HOME/android-sdk/cmdline-tools/ -type f | head -20
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° sdkmanager:"
          ls -la $HOME/android-sdk/cmdline-tools/latest/bin/sdkmanager || echo "âŒ sdkmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
      - name: ğŸ› ï¸ Install Android SDK components
        run: |
          echo "ğŸ”§ ==== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞšĞĞœĞŸĞĞĞ•ĞĞ¢ĞĞ’ ANDROID SDK ===="
          set -x
          
          echo "ğŸ”§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ..."
          export ANDROID_SDK_ROOT=/home/runner/android-sdk
          export ANDROID_HOME=/home/runner/android-sdk
          export PATH="$PATH:/home/runner/android-sdk/emulator:/home/runner/android-sdk/platform-tools:/home/runner/android-sdk/cmdline-tools/latest/bin"
          
          echo "ğŸ”§ ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
          echo "ğŸ”§ ANDROID_HOME: $ANDROID_HOME"
          echo "ğŸ”§ PATH: $PATH"
          
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° sdkmanager Ğ¿ĞµÑ€ĞµĞ´ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¾Ğ¹..."
          which sdkmanager || echo "âŒ sdkmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² PATH"
          ls -la $HOME/android-sdk/cmdline-tools/latest/bin/sdkmanager || echo "âŒ sdkmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ğ¾ Ğ¿ÑƒÑ‚Ğ¸"
          
          echo "ğŸ”§ ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¸Ğµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¹..."
          yes | sdkmanager --licenses || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: sdkmanager license error"; exit 1; }
          
          echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² SDK..."
          echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼: platform-tools, emulator, system-images;android-34;default;x86_64"
          sdkmanager "platform-tools" "emulator" "system-images;android-34;default;x86_64" || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: sdkmanager install error"; exit 1; }
          
          echo "ğŸ”§ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ£Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞĞ«Ğ¥ ĞšĞĞœĞŸĞĞĞ•ĞĞ¢ĞĞ’ ===="
          echo "ğŸ”§ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° SDK Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸:"
          find $ANDROID_SDK_ROOT/ -type d | head -20
          
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° platform-tools:"
          ls -la $ANDROID_SDK_ROOT/platform-tools/ || echo "âŒ platform-tools Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° emulator:"
          ls -la $ANDROID_SDK_ROOT/emulator/ || echo "âŒ emulator Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images:"
          find $ANDROID_SDK_ROOT/system-images/ -type f | head -10 || echo "âŒ system-images Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
          echo "ğŸ”§ ==== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
          echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ SDK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
          chmod +x $ANDROID_SDK_ROOT/platform-tools/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ platform-tools"
          chmod +x $ANDROID_SDK_ROOT/emulator/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ emulator"
          chmod +x $ANDROID_SDK_ROOT/emulator/qemu/linux-x86_64/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ qemu"
          chmod +x $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ cmdline-tools"
          
          echo "ğŸ”§ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
          echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
          ls -la $ANDROID_SDK_ROOT/platform-tools/adb || echo "âŒ adb Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
          ls -la $ANDROID_SDK_ROOT/emulator/emulator || echo "âŒ emulator Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° avdmanager:"
          ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager || echo "âŒ avdmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ ==== Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ¯ ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ===="
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸:"
          find $ANDROID_SDK_ROOT/system-images/ || echo "âŒ system-images dir not found"
          
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´:"
          $ANDROID_SDK_ROOT/platform-tools/adb version || echo "âŒ adb version failed"
          $ANDROID_SDK_ROOT/emulator/emulator -version || echo "âŒ emulator version failed"
          $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager list avd || echo "âŒ avdmanager failed"
      - name: ğŸ“¦ Upload Android SDK as artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-sdk
          path: ${{ env.ANDROID_SDK_ROOT }}

  # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ APK
  build-and-test:
    runs-on: ubuntu-latest
    needs: setup-android-sdk
    outputs:
      version: ${{ needs.setup-android-sdk.outputs.version }}
      version_code: ${{ needs.setup-android-sdk.outputs.version_code }}
      date: ${{ needs.setup-android-sdk.outputs.date }}
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ”§ Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          
      - name: ğŸ“¦ Download Android SDK artifact
        uses: actions/download-artifact@v4
        with:
          name: android-sdk
          path: /home/runner/android-sdk
          
      - name: ğŸ”§ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ (Build)
        run: |
          echo "ğŸ”§ ==== Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• (BUILD) ===="
          echo "ğŸ”§ ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
          echo "ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ SDK:"
          ls -la /home/runner/android-sdk/ || echo "âŒ SDK Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… SDK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
          chmod +x /home/runner/android-sdk/platform-tools/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ platform-tools"
          chmod +x /home/runner/android-sdk/emulator/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ emulator"
          chmod +x /home/runner/android-sdk/emulator/qemu/linux-x86_64/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ qemu"
          chmod +x /home/runner/android-sdk/cmdline-tools/latest/bin/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ cmdline-tools"
          
          echo "ğŸ”§ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞŸĞĞ¡Ğ›Ğ• Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ ===="
          echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
          ls -la /home/runner/android-sdk/platform-tools/adb | grep -E "^-r.x" || echo "âŒ adb Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
          
          echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
          ls -la /home/runner/android-sdk/emulator/emulator | grep -E "^-r.x" || echo "âŒ emulator Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
          
          echo "ğŸ”§ ==== Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞšĞĞœĞĞĞ” ===="
          echo "ğŸ”§ Ğ¢ĞµÑÑ‚ adb:"
          /home/runner/android-sdk/platform-tools/adb version || echo "âŒ adb version failed"
          
          echo "ğŸ”§ Ğ¢ĞµÑÑ‚ emulator:"
          /home/runner/android-sdk/emulator/emulator -version || echo "âŒ emulator version failed"
          
      - name: ğŸ—ï¸ Build APK
        run: |
          echo "ğŸ—ï¸ ==== Ğ¡Ğ‘ĞĞ ĞšĞ APK ===="
          echo "ğŸ—ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ..."
          export ANDROID_SDK_ROOT=/home/runner/android-sdk
          export ANDROID_HOME=/home/runner/android-sdk
          export PATH="$PATH:/home/runner/android-sdk/platform-tools:/home/runner/android-sdk/cmdline-tools/latest/bin"
          
          echo "ğŸ—ï¸ ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
          echo "ğŸ—ï¸ ANDROID_HOME: $ANDROID_HOME"
          echo "ğŸ—ï¸ PATH: $PATH"
          
          echo "ğŸ—ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Gradle wrapper..."
          ls -la ./gradlew || echo "âŒ gradlew Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          chmod +x ./gradlew || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° gradlew"
          
          echo "ğŸ—ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° app/build.gradle..."
          ls -la app/build.gradle || echo "âŒ app/build.gradle Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          cat app/build.gradle | grep -E "(versionName|versionCode|applicationId)" || echo "âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹"
          
          echo "ğŸ—ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..."
          ./gradlew clean || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: gradlew clean failed"; exit 1; }
          
          echo "ğŸ—ï¸ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° debug APK..."
          ./gradlew assembleDebug || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: gradlew assembleDebug failed"; exit 1; }
          
          echo "ğŸ—ï¸ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡ĞĞ‘Ğ ĞĞĞĞĞ“Ğ APK ===="
          echo "ğŸ—ï¸ ĞŸĞ¾Ğ¸ÑĞº APK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
          find . -name "*.apk" -type f || echo "âŒ APK Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
          
          echo "ğŸ—ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° app/build/outputs/apk/debug/..."
          ls -la app/build/outputs/apk/debug/ || echo "âŒ debug APK Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°"
          
          echo "ğŸ—ï¸ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ releases/debug..."
          mkdir -p releases/debug
          
          echo "ğŸ—ï¸ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ APK..."
          cp app/build/outputs/apk/debug/app-debug.apk releases/debug/latest-debug.apk || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ APK"; exit 1; }
          
          echo "ğŸ—ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ APK..."
          ls -la releases/debug/latest-debug.apk || echo "âŒ APK Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² releases/debug/"
          
          echo "ğŸ—ï¸ Ğ Ğ°Ğ·Ğ¼ĞµÑ€ APK:"
          du -h releases/debug/latest-debug.apk || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ APK"
          
          echo "ğŸ—ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° APK Ñ‡ĞµÑ€ĞµĞ· aapt..."
          /home/runner/android-sdk/build-tools/*/aapt dump badging releases/debug/latest-debug.apk | head -10 || echo "âŒ aapt failed"
          
      - name: ğŸ“¦ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: FinancialSuccess-v${{ needs.setup-android-sdk.outputs.version }}-${{ needs.setup-android-sdk.outputs.date }}
          path: releases/debug/latest-debug.apk

  # ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°
  screenshots-phone:
    runs-on: ubuntu-latest
    needs: [setup-android-sdk, build-and-test]
    env:
      ANDROID_SDK_ROOT: /home/runner/android-sdk
      ANDROID_HOME: /home/runner/android-sdk
    # Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ should_release
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ“¦ Download Android SDK artifact
      uses: actions/download-artifact@v4
      with:
        name: android-sdk
        path: ${{ env.ANDROID_SDK_ROOT }}
        
    - name: ğŸ“¦ Download APK artifact
      uses: actions/download-artifact@v4
      with:
        name: FinancialSuccess-v${{ needs.build-and-test.outputs.version }}-${{ needs.build-and-test.outputs.date }}
        path: releases/debug/
        
    - name: ğŸ§¾ Log Android SDK structure
      run: |
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ—ĞĞ“Ğ Ğ£Ğ–Ğ•ĞĞĞĞ“Ğ ANDROID SDK (PHONE) ===="
        echo "ğŸ” ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸:"
        ls -la $ANDROID_SDK_ROOT/ || echo "âŒ ANDROID_SDK_ROOT Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
        
        echo "ğŸ” ==== Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ SDK ===="
        find $ANDROID_SDK_ROOT/ -type d | head -20
        
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ¥ Ğ¤ĞĞ™Ğ›ĞĞ’ ===="
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb || echo "âŒ adb Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator || echo "âŒ emulator Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager || echo "âŒ avdmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images:"
        find $ANDROID_SDK_ROOT/system-images/ -name "*.img" | head -5 || echo "âŒ system-images Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
        
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb | grep -E "^-r.x" || echo "âŒ adb Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator | grep -E "^-r.x" || echo "âŒ emulator Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager | grep -E "^-r.x" || echo "âŒ avdmanager Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
    
    - name: ğŸ”§ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ (Phone)
      run: |
        echo "ğŸ”§ ==== Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
        echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… SDK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
        
        chmod +x $ANDROID_SDK_ROOT/platform-tools/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ platform-tools"
        chmod +x $ANDROID_SDK_ROOT/emulator/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ emulator"
        chmod +x $ANDROID_SDK_ROOT/emulator/qemu/linux-x86_64/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ qemu"
        chmod +x $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ cmdline-tools"
        
        echo "ğŸ”§ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞŸĞĞ¡Ğ›Ğ• Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ ===="
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb | grep -E "^-r.x" || echo "âŒ adb Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator | grep -E "^-r.x" || echo "âŒ emulator Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager | grep -E "^-r.x" || echo "âŒ avdmanager Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ==== Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞšĞĞœĞĞĞ” ===="
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ adb:"
        $ANDROID_SDK_ROOT/platform-tools/adb version || echo "âŒ adb version failed"
        
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ emulator:"
        $ANDROID_SDK_ROOT/emulator/emulator -version || echo "âŒ emulator version failed"
        
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ avdmanager:"
        $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager list avd || echo "âŒ avdmanager failed"

    - name: ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ adb Ğ² PATH (phone)
      run: |
        echo "ğŸ” Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ adb..."
        sudo dpkg --add-architecture i386
        sudo apt-get update
        sudo apt-get install -y libc6:i386 libstdc++6:i386 lib32z1 lib32stdc++6
        
        echo "ğŸ” ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° PATH Ğ´Ğ»Ñ adb..."
        export PATH="$PATH:/home/runner/android-sdk/platform-tools"
        echo "PATH: $PATH"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ adb..."
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° adb..."
        ls -la /home/runner/android-sdk/platform-tools/adb || echo "âŒ Ğ¤Ğ°Ğ¹Ğ» adb Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ..."
        file /home/runner/android-sdk/platform-tools/adb || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ°"
        
        echo "ğŸ” ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° adb Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¼Ñƒ Ğ¿ÑƒÑ‚Ğ¸..."
        /home/runner/android-sdk/platform-tools/adb version || echo "âŒ adb version failed"
        
        echo "ğŸ” ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° adb Ñ‡ĞµÑ€ĞµĞ· which..."
        which adb || echo "âŒ which adb failed"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº adb..."
        ldd /home/runner/android-sdk/platform-tools/adb || echo "âŒ ldd failed"

    - name: ğŸ­ Install Maestro
      run: |
        curl -Ls "https://get.maestro.mobile.dev" | bash
        export PATH="$PATH:$HOME/.maestro/bin"
        echo "n" | maestro --version

    - name: ğŸ“± Start Android Emulator and Install APK (Phone)
      shell: bash
      env:
        ANDROID_SDK_ROOT: /home/runner/android-sdk
        ANDROID_HOME: /home/runner/android-sdk
      run: |
        echo "ğŸ“± ==== Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ­ĞœĞ£Ğ›Ğ¯Ğ¢ĞĞ Ğ Ğ¢Ğ•Ğ›Ğ•Ğ¤ĞĞĞ ===="
        export PATH="$PATH:/home/runner/android-sdk/emulator:/home/runner/android-sdk/platform-tools:/home/runner/android-sdk/cmdline-tools/latest/bin"
        set -e
        
        echo "ğŸ“± ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ..."
        echo "ğŸ“± SDK root: $ANDROID_SDK_ROOT"
        echo "ğŸ“± ANDROID_HOME: $ANDROID_HOME"
        echo "ğŸ“± PATH: $PATH"
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images..."
        ls -la $ANDROID_SDK_ROOT/system-images/android-34/default/x86_64/ || echo "âŒ system-images Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
        
        echo "ğŸ“± ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… AVD..."
        rm -rf ~/.android/avd/*
        echo "ğŸ“± Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ~/.android/avd/ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸:"
        ls -la ~/.android/avd/ || echo "âŒ ~/.android/avd/ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"

        echo "ğŸ“± ==== Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• AVD ===="
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… AVD..."
        avdmanager list avd || echo "âŒ avdmanager list avd failed"
        
        echo "ğŸ“± Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ AVD ci_nexus5..."
        if ! avdmanager list avd | grep -q "ci_nexus5"; then
          echo "ğŸ“± AVD ci_nexus5 Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼..."
          echo "no" | avdmanager create avd --name "ci_nexus5" --package "system-images;android-34;default;x86_64" --device "Nexus 5" || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ AVD"; exit 1; }
          echo "âœ… AVD ci_nexus5 ÑĞ¾Ğ·Ğ´Ğ°Ğ½"
        else
          echo "âœ… AVD ci_nexus5 ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
        fi
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ AVD..."
        avdmanager list avd | grep ci_nexus5 || echo "âŒ AVD ci_nexus5 Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ"

        echo "ğŸ“± ==== Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ­ĞœĞ£Ğ›Ğ¯Ğ¢ĞĞ Ğ ===="
        echo "ğŸ“± Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ² Ñ„Ğ¾Ğ½Ğµ..."
        emulator -avd "ci_nexus5" -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim -accel off -no-snapshot -no-metrics -verbose &
        EMULATOR_PID=$!
        echo "ğŸ“± PID ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°: $EMULATOR_PID"
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"

        echo "ğŸ“± ĞŸĞ°ÑƒĞ·Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° (30 ÑĞµĞºÑƒĞ½Ğ´)..."
        sleep 30
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹..."
        ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹"

        echo "ğŸ“± ==== ĞĞ–Ğ˜Ğ”ĞĞĞ˜Ğ• ĞŸĞĞ¯Ğ’Ğ›Ğ•ĞĞ˜Ğ¯ Ğ’ ADB ===="
        emulator_timeout=120
        emulator_elapsed=0
        for i in {1..60}; do
          echo "ğŸ“± ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° $i/60: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° adb devices..."
          adb devices || echo "âŒ adb devices failed"
          
          if adb devices | grep -q "emulator"; then
            echo "âœ… Ğ­Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»ÑÑ Ğ² adb"
            echo "ğŸ“± ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²:"
            adb devices
            break
          fi
          
          if [ $i -eq 60 ]; then
            echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ·Ğ° $emulator_timeout ÑĞµĞºÑƒĞ½Ğ´"
            echo "ğŸ“± Ğ›Ğ¾Ğ³Ğ¸ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
            kill $EMULATOR_PID 2>/dev/null || true
            exit 1
          fi
          
          sleep 2
          emulator_elapsed=$((emulator_elapsed + 2))
          if [ $((emulator_elapsed % 30)) -eq 0 ]; then
            echo "â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°: $emulator_elapsed ÑĞµĞºÑƒĞ½Ğ´ Ğ¸Ğ· $emulator_timeout..."
            echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          fi
        done

        echo "ğŸ“± ==== ĞĞ–Ğ˜Ğ”ĞĞĞ˜Ğ• Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ˜ ANDROID ===="
        boot_timeout=180
        boot_elapsed=0
        for i in {1..90}; do
          echo "ğŸ“± ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° $i/90: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° sys.boot_completed..."
          adb shell getprop sys.boot_completed 2>/dev/null || echo "âŒ adb shell getprop failed"
          
          if adb shell getprop sys.boot_completed 2>/dev/null | grep -q "1"; then
            echo "âœ… Android Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½"
            echo "ğŸ“± Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸:"
            adb shell getprop | grep -E "(sys.boot_completed|init.svc.bootanim|init.svc.zygote)" || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°"
            break
          fi
          
          if [ $i -eq 90 ]; then
            echo "âŒ Android Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»ÑÑ Ğ·Ğ° $boot_timeout ÑĞµĞºÑƒĞ½Ğ´"
            echo "ğŸ“± ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸:"
            adb shell getprop | grep -E "(sys.boot_completed|init.svc.bootanim|init.svc.zygote)" || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°"
            kill $EMULATOR_PID 2>/dev/null || true
            exit 1
          fi
          
          sleep 2
          boot_elapsed=$((boot_elapsed + 2))
          if [ $((boot_elapsed % 30)) -eq 0 ]; then
            echo "â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Android: $boot_elapsed ÑĞµĞºÑƒĞ½Ğ´ Ğ¸Ğ· $boot_timeout..."
            echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          fi
        done

        echo "ğŸ“± ==== Ğ ĞĞ—Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞšĞ Ğ­ĞšĞ ĞĞĞ ===="
        echo "ğŸ“± Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° ÑĞºÑ€Ğ°Ğ½Ğ°..."
        adb shell input keyevent 82 || echo "âŒ keyevent 82 failed"
        adb shell input keyevent 82 || echo "âŒ keyevent 82 failed"
        sleep 2

        echo "ğŸ“± ==== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ APK ===="
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ APK..."
        if [ ! -f "releases/debug/latest-debug.apk" ]; then
          echo "âŒ Error: latest-debug.apk not found in releases/debug/"
          echo "ğŸ“± Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ releases/debug/:"
          ls -la releases/debug/ || echo "âŒ releases/debug/ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
          echo "ğŸ“± ĞŸĞ¾Ğ¸ÑĞº APK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ:"
          find . -name "*.apk" -type f || echo "âŒ APK Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
          kill $EMULATOR_PID 2>/dev/null || true
          exit 1
        fi
        
        echo "ğŸ“± Ğ Ğ°Ğ·Ğ¼ĞµÑ€ APK:"
        du -h releases/debug/latest-debug.apk || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ APK"
        
        echo "ğŸ“± Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° APK..."
        adb install releases/debug/latest-debug.apk || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: adb install failed"; kill $EMULATOR_PID 2>/dev/null || true; exit 1; }
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ APK..."
        adb shell pm list packages | grep financialsuccess || echo "âŒ ĞŸĞ°ĞºĞµÑ‚ financialsuccess Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        if adb shell pm list packages | grep -q financialsuccess; then
          echo "âœ… APK ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
          echo "ğŸ“± Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğµ:"
          adb shell pm dump financialsuccess | head -20 || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğµ"
        else
          echo "âŒ Error: APK installation failed"
          echo "ğŸ“± Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²:"
          adb shell pm list packages | head -20 || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²"
          kill $EMULATOR_PID 2>/dev/null || true
          exit 1
        fi

        echo "ğŸ“± ==== Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ˜Ğ• Ğ ĞĞ‘ĞĞ¢Ğ« ===="
        echo "ğŸ“± ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        kill $EMULATOR_PID 2>/dev/null || true
        pkill -f emulator 2>/dev/null || true
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        sleep 5
        ps aux | grep emulator | grep -v grep || echo "âœ… Ğ­Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"

    - name: ğŸ“¸ Run Maestro Screenshots (Phone)
      run: |
        export PATH="$PATH:$HOME/.maestro/bin"
        mkdir -p screenshots/phone
        
        # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°
        local config_file="maestro/screenshots-stable.yaml"
        if [ ! -f "$config_file" ]; then
          config_file="maestro/screenshots.yaml"
        fi
        
        if [ -f "$config_file" ]; then
          echo "Using phone screenshots configuration: $config_file"
          maestro test "$config_file" --format junit --output screenshots/phone/
          echo "ğŸ“± Phone screenshots completed!"
        else
          echo "âš ï¸ Warning: Maestro configuration file not found: $config_file"
          echo "ğŸ“± Phone screenshots skipped!"
        fi

    - name: ğŸ“¤ Upload Phone Screenshots
      uses: actions/upload-artifact@v4
      with:
        name: phone-screenshots-v${{ needs.build-and-test.outputs.version }}
        path: screenshots/phone/
        retention-days: 30

  # ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ½ÑˆĞµÑ‚Ğ°
  screenshots-tablet:
    runs-on: ubuntu-latest
    needs: [setup-android-sdk, build-and-test]
    env:
      ANDROID_SDK_ROOT: /home/runner/android-sdk
      ANDROID_HOME: /home/runner/android-sdk
    # Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ should_release
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ“¦ Download Android SDK artifact
      uses: actions/download-artifact@v4
      with:
        name: android-sdk
        path: ${{ env.ANDROID_SDK_ROOT }}
        
    - name: ğŸ“¦ Download APK artifact
      uses: actions/download-artifact@v4
      with:
        name: FinancialSuccess-v${{ needs.build-and-test.outputs.version }}-${{ needs.build-and-test.outputs.date }}
        path: releases/debug/
        
    - name: ğŸ§¾ Log Android SDK structure
      run: |
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ—ĞĞ“Ğ Ğ£Ğ–Ğ•ĞĞĞĞ“Ğ ANDROID SDK (TABLET) ===="
        echo "ğŸ” ANDROID_SDK_ROOT: $ANDROID_SDK_ROOT"
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸:"
        ls -la $ANDROID_SDK_ROOT/ || echo "âŒ ANDROID_SDK_ROOT Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
        
        echo "ğŸ” ==== Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ SDK ===="
        find $ANDROID_SDK_ROOT/ -type d | head -20
        
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ¥ Ğ¤ĞĞ™Ğ›ĞĞ’ ===="
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb || echo "âŒ adb Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator || echo "âŒ emulator Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager || echo "âŒ avdmanager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images:"
        find $ANDROID_SDK_ROOT/system-images/ -name "*.img" | head -5 || echo "âŒ system-images Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
        
        echo "ğŸ” ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb | grep -E "^-r.x" || echo "âŒ adb Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator | grep -E "^-r.x" || echo "âŒ emulator Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ” ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager | grep -E "^-r.x" || echo "âŒ avdmanager Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
    
    - name: ğŸ”§ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ (Tablet)
      run: |
        echo "ğŸ”§ ==== Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞ ĞĞ’ ĞĞ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ===="
        echo "ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… SDK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
        
        chmod +x $ANDROID_SDK_ROOT/platform-tools/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ platform-tools"
        chmod +x $ANDROID_SDK_ROOT/emulator/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ emulator"
        chmod +x $ANDROID_SDK_ROOT/emulator/qemu/linux-x86_64/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ qemu"
        chmod +x $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/* || echo "âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ cmdline-tools"
        
        echo "ğŸ”§ ==== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞŸĞ ĞĞ’ ĞŸĞĞ¡Ğ›Ğ• Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ ===="
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° adb:"
        ls -la $ANDROID_SDK_ROOT/platform-tools/adb | grep -E "^-r.x" || echo "âŒ adb Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° emulator:"
        ls -la $ANDROID_SDK_ROOT/emulator/emulator | grep -E "^-r.x" || echo "âŒ emulator Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ĞŸÑ€Ğ°Ğ²Ğ° Ğ½Ğ° avdmanager:"
        ls -la $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager | grep -E "^-r.x" || echo "âŒ avdmanager Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ"
        
        echo "ğŸ”§ ==== Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞšĞĞœĞĞĞ” ===="
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ adb:"
        $ANDROID_SDK_ROOT/platform-tools/adb version || echo "âŒ adb version failed"
        
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ emulator:"
        $ANDROID_SDK_ROOT/emulator/emulator -version || echo "âŒ emulator version failed"
        
        echo "ğŸ”§ Ğ¢ĞµÑÑ‚ avdmanager:"
        $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/avdmanager list avd || echo "âŒ avdmanager failed"

    - name: ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ adb Ğ² PATH (tablet)
      run: |
        echo "ğŸ” Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ adb..."
        sudo dpkg --add-architecture i386
        sudo apt-get update
        sudo apt-get install -y libc6:i386 libstdc++6:i386 lib32z1 lib32stdc++6
        
        echo "ğŸ” ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° PATH Ğ´Ğ»Ñ adb..."
        export PATH="$PATH:/home/runner/android-sdk/platform-tools"
        echo "PATH: $PATH"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ adb..."
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° adb..."
        ls -la /home/runner/android-sdk/platform-tools/adb || echo "âŒ Ğ¤Ğ°Ğ¹Ğ» adb Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ..."
        file /home/runner/android-sdk/platform-tools/adb || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ°"
        
        echo "ğŸ” ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° adb Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¼Ñƒ Ğ¿ÑƒÑ‚Ğ¸..."
        /home/runner/android-sdk/platform-tools/adb version || echo "âŒ adb version failed"
        
        echo "ğŸ” ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° adb Ñ‡ĞµÑ€ĞµĞ· which..."
        which adb || echo "âŒ which adb failed"
        
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº adb..."
        ldd /home/runner/android-sdk/platform-tools/adb || echo "âŒ ldd failed"

    - name: ğŸ­ Install Maestro
      run: |
        curl -Ls "https://get.maestro.mobile.dev" | bash
        export PATH="$PATH:$HOME/.maestro/bin"
        echo "n" | maestro --version

    - name: ğŸ“± Start Android Emulator and Install APK (Tablet)
      shell: bash
      env:
        ANDROID_SDK_ROOT: /home/runner/android-sdk
        ANDROID_HOME: /home/runner/android-sdk
      run: |
        echo "ğŸ“± ==== Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ­ĞœĞ£Ğ›Ğ¯Ğ¢ĞĞ Ğ ĞŸĞ›ĞĞĞ¨Ğ•Ğ¢Ğ ===="
        export PATH="$PATH:/home/runner/android-sdk/emulator:/home/runner/android-sdk/platform-tools:/home/runner/android-sdk/cmdline-tools/latest/bin"
        set -e
        
        echo "ğŸ“± ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ..."
        echo "ğŸ“± SDK root: $ANDROID_SDK_ROOT"
        echo "ğŸ“± ANDROID_HOME: $ANDROID_HOME"
        echo "ğŸ“± PATH: $PATH"
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° system-images..."
        ls -la $ANDROID_SDK_ROOT/system-images/android-34/default/x86_64/ || echo "âŒ system-images Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
        
        echo "ğŸ“± ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… AVD..."
        rm -rf ~/.android/avd/*
        echo "ğŸ“± Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ~/.android/avd/ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸:"
        ls -la ~/.android/avd/ || echo "âŒ ~/.android/avd/ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"

        echo "ğŸ“± ==== Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• AVD ===="
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… AVD..."
        avdmanager list avd || echo "âŒ avdmanager list avd failed"
        
        echo "ğŸ“± Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ AVD ci_nexus10..."
        if ! avdmanager list avd | grep -q "ci_nexus10"; then
          echo "ğŸ“± AVD ci_nexus10 Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼..."
          echo "no" | avdmanager create avd --name "ci_nexus10" --package "system-images;android-34;default;x86_64" --device "Nexus 10" || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ AVD"; exit 1; }
          echo "âœ… AVD ci_nexus10 ÑĞ¾Ğ·Ğ´Ğ°Ğ½"
        else
          echo "âœ… AVD ci_nexus10 ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
        fi
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ AVD..."
        avdmanager list avd | grep ci_nexus10 || echo "âŒ AVD ci_nexus10 Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ"

        echo "ğŸ“± ==== Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ­ĞœĞ£Ğ›Ğ¯Ğ¢ĞĞ Ğ ===="
        echo "ğŸ“± Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ² Ñ„Ğ¾Ğ½Ğµ..."
        emulator -avd "ci_nexus10" -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim -accel off -no-snapshot -no-metrics -verbose &
        EMULATOR_PID=$!
        echo "ğŸ“± PID ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°: $EMULATOR_PID"
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"

        echo "ğŸ“± ĞŸĞ°ÑƒĞ·Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° (30 ÑĞµĞºÑƒĞ½Ğ´)..."
        sleep 30
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹..."
        ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹"

        echo "ğŸ“± ==== ĞĞ–Ğ˜Ğ”ĞĞĞ˜Ğ• ĞŸĞĞ¯Ğ’Ğ›Ğ•ĞĞ˜Ğ¯ Ğ’ ADB ===="
        emulator_timeout=120
        emulator_elapsed=0
        for i in {1..60}; do
          echo "ğŸ“± ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° $i/60: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° adb devices..."
          adb devices || echo "âŒ adb devices failed"
          
          if adb devices | grep -q "emulator"; then
            echo "âœ… Ğ­Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»ÑÑ Ğ² adb"
            echo "ğŸ“± ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²:"
            adb devices
            break
          fi
          
          if [ $i -eq 60 ]; then
            echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ·Ğ° $emulator_timeout ÑĞµĞºÑƒĞ½Ğ´"
            echo "ğŸ“± Ğ›Ğ¾Ğ³Ğ¸ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
            kill $EMULATOR_PID 2>/dev/null || true
            exit 1
          fi
          
          sleep 2
          emulator_elapsed=$((emulator_elapsed + 2))
          if [ $((emulator_elapsed % 30)) -eq 0 ]; then
            echo "â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°: $emulator_elapsed ÑĞµĞºÑƒĞ½Ğ´ Ğ¸Ğ· $emulator_timeout..."
            echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          fi
        done

        echo "ğŸ“± ==== ĞĞ–Ğ˜Ğ”ĞĞĞ˜Ğ• Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ˜ ANDROID ===="
        boot_timeout=180
        boot_elapsed=0
        for i in {1..90}; do
          echo "ğŸ“± ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° $i/90: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° sys.boot_completed..."
          adb shell getprop sys.boot_completed 2>/dev/null || echo "âŒ adb shell getprop failed"
          
          if adb shell getprop sys.boot_completed 2>/dev/null | grep -q "1"; then
            echo "âœ… Android Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½"
            echo "ğŸ“± Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸:"
            adb shell getprop | grep -E "(sys.boot_completed|init.svc.bootanim|init.svc.zygote)" || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°"
            break
          fi
          
          if [ $i -eq 90 ]; then
            echo "âŒ Android Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»ÑÑ Ğ·Ğ° $boot_timeout ÑĞµĞºÑƒĞ½Ğ´"
            echo "ğŸ“± ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸:"
            adb shell getprop | grep -E "(sys.boot_completed|init.svc.bootanim|init.svc.zygote)" || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°"
            kill $EMULATOR_PID 2>/dev/null || true
            exit 1
          fi
          
          sleep 2
          boot_elapsed=$((boot_elapsed + 2))
          if [ $((boot_elapsed % 30)) -eq 0 ]; then
            echo "â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Android: $boot_elapsed ÑĞµĞºÑƒĞ½Ğ´ Ğ¸Ğ· $boot_timeout..."
            echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°:"
            ps aux | grep emulator | grep -v grep || echo "âŒ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          fi
        done

        echo "ğŸ“± ==== Ğ ĞĞ—Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞšĞ Ğ­ĞšĞ ĞĞĞ ===="
        echo "ğŸ“± Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° ÑĞºÑ€Ğ°Ğ½Ğ°..."
        adb shell input keyevent 82 || echo "âŒ keyevent 82 failed"
        adb shell input keyevent 82 || echo "âŒ keyevent 82 failed"
        sleep 2

        echo "ğŸ“± ==== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ APK ===="
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ APK..."
        if [ ! -f "releases/debug/latest-debug.apk" ]; then
          echo "âŒ Error: latest-debug.apk not found in releases/debug/"
          echo "ğŸ“± Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ releases/debug/:"
          ls -la releases/debug/ || echo "âŒ releases/debug/ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"
          echo "ğŸ“± ĞŸĞ¾Ğ¸ÑĞº APK Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ:"
          find . -name "*.apk" -type f || echo "âŒ APK Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
          kill $EMULATOR_PID 2>/dev/null || true
          exit 1
        fi
        
        echo "ğŸ“± Ğ Ğ°Ğ·Ğ¼ĞµÑ€ APK:"
        du -h releases/debug/latest-debug.apk || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ APK"
        
        echo "ğŸ“± Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° APK..."
        adb install releases/debug/latest-debug.apk || { echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: adb install failed"; kill $EMULATOR_PID 2>/dev/null || true; exit 1; }
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ APK..."
        adb shell pm list packages | grep financialsuccess || echo "âŒ ĞŸĞ°ĞºĞµÑ‚ financialsuccess Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
        
        if adb shell pm list packages | grep -q financialsuccess; then
          echo "âœ… APK ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
          echo "ğŸ“± Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğµ:"
          adb shell pm dump financialsuccess | head -20 || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğµ"
        else
          echo "âŒ Error: APK installation failed"
          echo "ğŸ“± Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²:"
          adb shell pm list packages | head -20 || echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²"
          kill $EMULATOR_PID 2>/dev/null || true
          exit 1
        fi

        echo "ğŸ“± ==== Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ˜Ğ• Ğ ĞĞ‘ĞĞ¢Ğ« ===="
        echo "ğŸ“± ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        kill $EMULATOR_PID 2>/dev/null || true
        pkill -f emulator 2>/dev/null || true
        
        echo "ğŸ“± ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°..."
        sleep 5
        ps aux | grep emulator | grep -v grep || echo "âœ… Ğ­Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"

    - name: ğŸ“¸ Run Maestro Screenshots (Tablet)
      run: |
        export PATH="$PATH:$HOME/.maestro/bin"
        mkdir -p screenshots/tablet
        
        # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ½ÑˆĞµÑ‚Ğ°
        local config_file="maestro/screenshots-tablet.yaml"
        if [ ! -f "$config_file" ]; then
          config_file="maestro/screenshots.yaml"
        fi
        
        if [ -f "$config_file" ]; then
          echo "Using tablet screenshots configuration: $config_file"
          maestro test "$config_file" --format junit --output screenshots/tablet/
          echo "ğŸ“± Tablet screenshots completed!"
        else
          echo "âš ï¸ Warning: Maestro configuration file not found: $config_file"
          echo "ğŸ“± Tablet screenshots skipped!"
        fi

    - name: ğŸ“¤ Upload Tablet Screenshots
      uses: actions/upload-artifact@v4
      with:
        name: tablet-screenshots-v${{ needs.build-and-test.outputs.version }}
        path: screenshots/tablet/
        retention-days: 30

  # Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ñ€ĞµĞ»Ğ¸Ğ·Ğ°
  create-release:
    runs-on: ubuntu-latest
    needs: [setup-android-sdk, build-and-test, screenshots-phone, screenshots-tablet]
    # Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ should_release
    permissions:
      contents: write

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ“¥ Download APK
      uses: actions/download-artifact@v4
      with:
        name: FinancialSuccess-v${{ needs.build-and-test.outputs.version }}-${{ needs.build-and-test.outputs.date }}

    - name: ğŸ“¥ Download Phone Screenshots
      uses: actions/download-artifact@v4
      with:
        name: phone-screenshots-v${{ needs.build-and-test.outputs.version }}

    - name: ğŸ“¥ Download Tablet Screenshots
      uses: actions/download-artifact@v4
      with:
        name: tablet-screenshots-v${{ needs.build-and-test.outputs.version }}

    - name: ğŸ“¸ Prepare screenshots for repository
      run: |
        mkdir -p screenshots/phone screenshots/tablet
        
        # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ñ‹ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸
        if [ -d "screenshots/phone" ]; then
          cp -r screenshots/phone/* screenshots/phone/ 2>/dev/null || true
        fi
        if [ -d "screenshots/tablet" ]; then
          cp -r screenshots/tablet/* screenshots/tablet/ 2>/dev/null || true
        fi
        
        echo "ğŸ“± Phone screenshots:"
        ls -la screenshots/phone/ 2>/dev/null || echo "No phone screenshots"
        echo ""
        echo "ğŸ“± Tablet screenshots:"
        ls -la screenshots/tablet/ 2>/dev/null || echo "No tablet screenshots"

    - name: ğŸ“ Commit Screenshots to Repository
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add screenshots/
        if git diff --staged --quiet; then
          echo "No screenshots to commit"
        else
          git commit -m "ğŸ“¸ Auto-generated screenshots v${{ needs.build-and-test.outputs.version }} - ${{ needs.build-and-test.outputs.date }}
          
          ğŸ“± Screenshots:
          - Phone: $(ls screenshots/phone/*.png 2>/dev/null | wc -l) files
          - Tablet: $(ls screenshots/tablet/*.png 2>/dev/null | wc -l) files
          - Total: $(find screenshots/ -name "*.png" 2>/dev/null | wc -l) files"
          git push
        fi

    - name: ğŸ·ï¸ Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ needs.build-and-test.outputs.version }}-${{ needs.build-and-test.outputs.date }}
        name: "ğŸ® Financial Success v${{ needs.build-and-test.outputs.version }}"
        body_path: RELEASE_NOTES.md
        files: |
          releases/debug/*.apk
          screenshots/phone/*.png
          screenshots/tablet/*.png
        draft: false
        prerelease: false
        generate_release_notes: false

    - name: ğŸ“Š Build Summary
      run: |
        echo "ğŸ‰ Release completed successfully!"
        echo ""
        echo "ï¿½ Results:"
        echo "ï¿½ï¿½ Version: ${{ needs.build-and-test.outputs.version }}"
        echo "ğŸ”¢ Version Code: ${{ needs.build-and-test.outputs.version_code }}"
        echo "ğŸ“… Date: ${{ needs.build-and-test.outputs.date }}"
        echo "ï¿½ APK: releases/debug/FinancialSuccess-v${{ needs.build-and-test.outputs.version }}-${{ needs.build-and-test.outputs.date }}-debug.apk"
        echo "ğŸ“¸ Phone screenshots: screenshots/phone/"
        echo "ğŸ“¸ Tablet screenshots: screenshots/tablet/"
        echo ""
        echo "ï¿½ Files:"
        ls -la releases/debug/ || echo "No APK files found"
        echo ""
        echo "ğŸ“¸ Phone screenshots:"
        ls -la screenshots/phone/ 2>/dev/null || echo "No phone screenshots"
        echo ""
        echo "ğŸ“¸ Tablet screenshots:"
        ls -la screenshots/tablet/ 2>/dev/null || echo "No tablet screenshots"
