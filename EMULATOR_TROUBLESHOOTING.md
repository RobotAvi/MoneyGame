# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Android —ç–º—É–ª—è—Ç–æ—Ä–æ–º –≤ CI/CD

## –ü—Ä–æ–±–ª–µ–º–∞

–°–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç –Ω–∞ —à–∞–≥–µ —Å —ç–º—É–ª—è—Ç–æ—Ä–æ–º Android —Å –æ—à–∏–±–∫–∞–º–∏:
- `adb: device offline`
- `android.os.DeadSystemException`
- –≠–º—É–ª—è—Ç–æ—Ä –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω –∏ —á–∞—Å—Ç–æ "—É–º–∏—Ä–∞–µ—Ç"

## –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º

### 1. –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —ç–º—É–ª—è—Ç–æ—Ä–∞ –≤ CI –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –≠–º—É–ª—è—Ç–æ—Ä Android –≤ CI/CD –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —á–∞—Å—Ç–æ –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω
- **–ü—Ä–∏—á–∏–Ω–∞**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å ADB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- **–ü—Ä–æ–±–ª–µ–º–∞**: ADB –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —ç–º—É–ª—è—Ç–æ—Ä—É
- **–ü—Ä–∏—á–∏–Ω–∞**: –≠–º—É–ª—è—Ç–æ—Ä –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∏–ª–∏ —É–ø–∞–ª

### 3. DeadSystemException
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–∏—Å—Ç–µ–º–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞ "—É–º–∏—Ä–∞–µ—Ç" –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `build-with-screenshots-fixed.yml` —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏:

#### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–º—É–ª—è—Ç–æ—Ä–∞**:
   ```yaml
   emulator-options: |
     -no-window
     -no-audio
     -no-boot-anim
     -gpu swiftshader_indirect
     -camera-back none
     -camera-front none
     -memory 2048
     -cores 2
     -skin 1080x1920
     -accel on
   ```

2. **–£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**:
   ```bash
   # –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —ç–º—É–ª—è—Ç–æ—Ä–∞
   adb wait-for-device
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
   while ! adb shell getprop sys.boot_completed 2>/dev/null | grep -q "1"; do
     echo "Waiting for boot completion..."
     sleep 5
   done
   
   # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
   sleep 10
   ```

3. **Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK**:
   ```bash
   install_apk_with_retry() {
     local max_attempts=5
     local attempt=1
     
     while [ $attempt -le $max_attempts ]; do
       # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç–º—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
       if ! adb devices | grep -q "emulator-5554"; then
         echo "Emulator not found, waiting..."
         sleep 10
         attempt=$((attempt + 1))
         continue
       fi
       
       # –ü—ã—Ç–∞–µ–º—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK
       if adb install releases/debug/*.apk; then
         echo "APK installed successfully!"
         return 0
       else
         echo "Installation failed, attempt $attempt/$max_attempts"
         sleep 10
         attempt=$((attempt + 1))
       fi
     done
   }
   ```

### –†–µ—à–µ–Ω–∏–µ 2: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `build-with-screenshots-alternative.yml` —Å –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
1. **–ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞**:
   - API Level 29 –≤–º–µ—Å—Ç–æ 30
   - –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ (1536MB –≤–º–µ—Å—Ç–æ 2048MB)
   - –û–¥–∏–Ω CPU core –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

2. **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã Maestro**:
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ç–µ—Å—Ç —Ç–æ–ª—å–∫–æ —Å –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**:
   ```bash
   # –û—á–∏—â–∞–µ–º –∫—ç—à –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
   adb shell pm clear com.android.packageinstaller 2>/dev/null || true
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
   if adb shell pm list packages | grep -q financialsuccess; then
     echo "Application verified as installed"
   ```

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Firebase Test Lab (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firebase Test Lab:

```yaml
- name: Run Firebase Test Lab
  run: |
    gcloud firebase test android run \
      --type instrumentation \
      --app releases/debug/*.apk \
      --test maestro/screenshots.yaml \
      --device model=redfin,version=30,locale=en,orientation=portrait \
      --timeout 30m \
      --results-dir=firebase-test-results
```

**–¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
- Google Cloud Project
- Service Account Key
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase Test Lab

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 1. –ù–∞—á–Ω–∏—Ç–µ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `build-with-screenshots-fixed.yml` - –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### 2. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è
–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ `build-with-screenshots-alternative.yml` —Å –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### 3. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Firebase Test Lab –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞
adb devices

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
adb shell getprop sys.boot_completed

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
adb shell pm list packages | grep financialsuccess

# –õ–æ–≥–∏ —ç–º—É–ª—è—Ç–æ—Ä–∞
adb logcat
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

1. **–≠–º—É–ª—è—Ç–æ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**:
   - –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤

2. **APK –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è**:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ retry –ª–æ–≥–∏–∫—É
   - –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

3. **Maestro –ø–∞–¥–∞–µ—Ç**:
   - –£–ø—Ä–æ—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
   - –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º—ã —Å —ç–º—É–ª—è—Ç–æ—Ä–æ–º Android –≤ CI/CD - —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏:

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è** - –æ—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è** - –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥
3. **Firebase Test Lab** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏.